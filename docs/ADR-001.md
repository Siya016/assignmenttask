# ADR-001



## Context
The Solar Ops Mini-Cockpit requires interactive time-series charts with shared brush selection for analyzing solar data across multiple visualizations. Key requirements:

- Time-series charts with brush selection
- Shared brush state across all charts
- Power factor histogram with color coding
- Cross-site energy comparison (bar charts)


## Decision
We use **Visx for time-series charts with brush functionality** and **Recharts for histograms and bar charts**, both loaded dynamically.

## Rationale

### Visx Advantages (Time-Series)
- **Brush Component**: Native brush selection with shared state capability
- **Performance**: Efficient rendering with memoization and data filtering




### Implementation Achieved

#### Dynamic Loading Strategy
```typescript
// Next.js dynamic imports for performance
const TimeSeriesChart = dynamic(() => import('./TimeSeriesChart'), {
  loading: () => <ChartSkeleton />,
  ssr: false
});
```

#### Shared Brush Implementation
```typescript
// Zustand store manages shared brush state
const { sharedBrush, setSharedBrush } = useStore();

// All charts filter data based on shared brush
const filteredData = useMemo(() => {
  if (!sharedBrush) return data;
  return data.filter(d => 
    new Date(d.timestamp) >= sharedBrush.start && 
    new Date(d.timestamp) <= sharedBrush.end
  );
}, [data, sharedBrush]);
```

#### Performance Optimizations
- **React.memo**: All chart components memoized
- **Data Limiting**: Max 500 points per chart
- **Bundle Splitting**: Charts in separate async chunk
- **SSR Disabled**: Charts only render client-side



### Performance Metrics
- **LCP**: 1.72s < 2.5s ✅
- **CLS**: 0.0006 < 0.1 ✅
- **TTI**: Optimized with dynamic imports

## Consequences

### Positive
- **Shared Brush**: All charts update simultaneously when brush changes
- **Performance**: Meets Core Web Vitals budgets
- **User Experience**: Smooth interactions with memoized components
- **Accessibility**: Full keyboard navigation and screen reader support
- **Maintainability**: Clean separation between time-series and standard charts

### Negative
- **Complexity**: Two chart libraries require different patterns
- **Bundle Size**: Combined libraries larger than single solution
- **Learning Curve**: Visx requires D3 knowledge for customization

### Mitigation Strategies
- **Abstraction**: Wrapper components hide library differences
- **Documentation**: Clear examples for both chart types
- **Performance**: Dynamic imports and memoization offset bundle size
- **Testing**: Unified testing patterns with React Testing Library
- **Fallbacks**: Graceful "No data available" states when charts fail